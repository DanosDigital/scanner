<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Permissions-Policy"
    content="accelerometer=(), autoplay=(), camera=(), encrypted-media=(), fullscreen=(), geolocation=(), gyroscope=(), hid=(), interest-cohort=(), magnetometer=(), microphone=(), payment=(), picture-in-picture=(), serial=(), sync-xhr=(), usb=(), xr-spatial-tracking=()">
  <title>CineBook - Movie Ticket Booking</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #e50914;
      --primary-dark: #b2070f;
      --secondary: #e5b50a;
      --dark: #141414;
      --dark-gray: #222;
      --medium-gray: #444;
      --light-gray: #777;
      --light: #f4f4f4;
      --white: #ffffff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background-color: var(--dark);
      color: var(--light);
      min-height: 100vh;
    }

    /* Header Styles */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 50px;
      background-color: rgba(0, 0, 0, 0.9);
      position: fixed;
      width: 100%;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }

    .logo {
      color: var(--primary);
      font-size: 2rem;
      font-weight: bold;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo i {
      font-size: 1.8rem;
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 25px;
    }

    nav ul li a {
      color: var(--light);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
      font-size: 1.1rem;
    }

    nav ul li a:hover {
      color: var(--primary);
    }

    .auth-buttons {
      display: flex;
      gap: 15px;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      position: relative;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }

    .user-menu {
      position: absolute;
      top: 50px;
      right: 0;
      background-color: var(--dark-gray);
      border-radius: 5px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      width: 200px;
      overflow: hidden;
      display: none;
    }

    .user-menu.active {
      display: block;
    }

    .user-menu a {
      display: block;
      padding: 12px 20px;
      color: var(--light);
      text-decoration: none;
      transition: background-color 0.3s;
    }

    .user-menu a:hover {
      background-color: var(--medium-gray);
    }

    .user-menu a i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }

    /* Button Styles */
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      font-size: 1rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none !important;
      /* Prevents link styling override */
      box-shadow: none !important;
      /* Prevents conflicting shadow styles */
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
      border: 2px solid var(--primary)
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      border-color: var(--primary-dark)
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--light);
      color: var(--light);
    }

    .btn-outline:hover {
      background-color: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background-color: var(--secondary);
      color: var(--dark);
    }

    .btn-secondary:hover {
      background-color: #d1a309;
      transform: translateY(-2px);
    }

    .btn-sm {
      padding: 8px 15px;
      font-size: 0.9rem;
    }

    .btn-lg {
      padding: 12px 30px;
      font-size: 1.1rem;
    }

    /* Hero Section */
    .hero {
      height: 90vh;
      background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://media.themoviedb.org/t/p/w1066_and_h600_bestv2/fTrQsdMS2MUw00RnzH0r3JWHhts.jpg') no-repeat center center/cover;
      display: flex;
      align-items: center;
      padding: 0 50px;
      position: relative;
      margin-bottom: 50px;
    }

    .hero::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100px;
      background: linear-gradient(transparent, var(--dark));
    }

    .hero-content {
      max-width: 600px;
      margin-top: 60px;
    }

    .hero h1 {
      font-size: 3.5rem;
      margin-bottom: 20px;
      line-height: 1.2;
    }

    .hero p {
      font-size: 1.2rem;
      margin-bottom: 30px;
      color: rgba(255, 255, 255, 0.9);
    }

    .hero-buttons {
      display: flex;
      gap: 20px;
    }

    /* Movies Section */
    .section {
      padding: 50px;
    }

    .section-title {
      font-size: 2rem;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .section-title .view-all {
      font-size: 1rem;
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }

    .section-title .view-all:hover {
      text-decoration: underline;
    }

    .filter-controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-controls select,
    .filter-controls input {
      padding: 10px 15px;
      background-color: var(--dark-gray);
      color: var(--light);
      border: 1px solid var(--medium-gray);
      border-radius: 4px;
      min-width: 200px;
      font-size: 1rem;
    }

    .filter-controls input {
      flex-grow: 1;
      max-width: 400px;
    }

    .movie-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 30px;
    }

    .movie-card {
      background-color: var(--dark-gray);
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
    }

    .movie-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .movie-poster {
      width: 100%;
      height: 330px;
      object-fit: cover;
      transition: transform 0.5s;
    }

    .movie-card:hover .movie-poster {
      transform: scale(1.05);
    }

    .movie-info {
      padding: 15px;
      position: relative;
      z-index: 1;
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
      margin-top: -60px;
    }

    .movie-title {
      font-size: 1.1rem;
      margin-bottom: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .movie-meta {
      display: flex;
      justify-content: space-between;
      color: var(--light-gray);
      font-size: 0.9rem;
    }

    .movie-rating {
      color: var(--secondary);
      font-weight: 500;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      overflow-y: auto;
    }

    .modal-content {
      background-color: var(--dark);
      margin: 50px auto;
      max-width: 900px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
      animation: modalFadeIn 0.3s;
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      padding: 20px;
      background-color: var(--dark-gray);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--medium-gray);
    }

    .close-modal {
      background: none;
      border: none;
      color: var(--light);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.3s;
    }

    .close-modal:hover {
      color: var(--primary);
    }

    .modal-body {
      display: flex;
      padding: 0;
    }

    .movie-details {
      flex: 1;
      padding: 20px;
    }

    .movie-trailer {
      width: 100%;
      height: 300px;
      background-color: #000;
      margin-bottom: 20px;
      border-radius: 5px;
      overflow: hidden;
    }

    .movie-trailer iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .movie-description {
      margin-bottom: 20px;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.9);
    }

    .movie-cast,
    .movie-director,
    .movie-rating-info {
      margin-bottom: 15px;
    }

    .movie-cast h3,
    .movie-director h3,
    .movie-rating-info h3 {
      margin-bottom: 5px;
      color: var(--primary);
    }

    .movie-cast p,
    .movie-director p {
      color: rgba(255, 255, 255, 0.8);
    }

    .movie-rating-info p {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .movie-rating-info .rating-badge {
      background-color: var(--secondary);
      color: var(--dark);
      padding: 3px 8px;
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .showtime-selector {
      width: 300px;
      padding: 20px;
      background-color: var(--dark-gray);
      border-left: 1px solid var(--medium-gray);
    }

    .showtime-date {
      margin-bottom: 20px;
    }

    .showtime-date h3 {
      margin-bottom: 10px;
      color: var(--primary);
    }

    .date-selector {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 10px;
      scrollbar-width: thin;
      scrollbar-color: var(--primary) var(--dark-gray);
    }

    .date-selector::-webkit-scrollbar {
      height: 5px;
    }

    .date-selector::-webkit-scrollbar-track {
      background: var(--dark-gray);
    }

    .date-selector::-webkit-scrollbar-thumb {
      background-color: var(--primary);
      border-radius: 5px;
    }

    .date-option {
      padding: 10px 15px;
      background-color: var(--dark);
      border-radius: 4px;
      cursor: pointer;
      white-space: nowrap;
      border: 1px solid var(--medium-gray);
      transition: all 0.3s;
    }

    .date-option:hover {
      border-color: var(--primary);
    }

    .date-option.active {
      background-color: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    .showtime-time {
      margin-bottom: 20px;
    }

    .showtime-time h3 {
      margin-bottom: 10px;
      color: var(--primary);
    }

    .time-slots {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .time-slot {
      padding: 10px;
      background-color: var(--dark);
      border-radius: 4px;
      text-align: center;
      cursor: pointer;
      border: 1px solid var(--medium-gray);
      transition: all 0.3s;
    }

    .time-slot:hover {
      border-color: var(--primary);
    }

    .time-slot.active {
      background-color: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    /* Seat Selection */
    .seat-selection {
      padding: 30px;
      display: none;
      max-width: 1000px;
      margin: 0 auto;
    }

    .screen {
      background: linear-gradient(to right, #333, #666, #333);
      color: white;
      text-align: center;
      padding: 15px;
      margin-bottom: 30px;
      border-radius: 5px;
      font-weight: 600;
      letter-spacing: 2px;
      text-transform: uppercase;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .seat-map-container {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }

    .seat-map {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .seat-row {
      display: flex;
      margin-bottom: 10px;
    }

    .seat {
      width: 35px;
      height: 35px;
      margin: 0 5px;
      background-color: var(--medium-gray);
      border-radius: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      font-size: 0.7rem;
      font-weight: 600;
      transition: all 0.3s;
    }

    .seat:hover {
      transform: scale(1.1);
    }

    .seat.available {
      background-color: var(--light);
      color: var(--dark);
    }

    .seat.selected {
      background-color: var(--primary);
      color: white;
      transform: scale(1.1);
    }

    .seat.vip {
      background-color: var(--secondary);
      color: var(--dark);
    }

    .seat.vip.selected {
      background-color: var(--primary);
      color: white;
    }

    .seat.occupied {
      background-color: var(--dark-gray);
      cursor: not-allowed;
      position: relative;
    }

    .seat.occupied::after {
      content: '✗';
      position: absolute;
      color: var(--primary);
      font-size: 1rem;
    }

    .seat-legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 3px;
    }

    .booking-summary {
      background-color: var(--dark-gray);
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .booking-summary h3 {
      margin-bottom: 15px;
      color: var(--primary);
      font-size: 1.3rem;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px dashed var(--medium-gray);
    }

    .summary-row:last-child {
      border-bottom: none;
    }

    .total {
      font-size: 1.2rem;
      font-weight: bold;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 2px solid var(--medium-gray);
    }

    /* Checkout Modal */
    .checkout-modal {
      display: none;
    }

    .checkout-steps {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--medium-gray);
    }

    .step {
      padding: 15px 25px;
      position: relative;
      color: var(--light-gray);
      font-weight: 500;
    }

    .step.active {
      color: var(--primary);
    }

    .step.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: var(--primary);
    }

    .payment-section {
      padding: 20px;
    }

    .payment-methods {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .payment-method {
      padding: 15px;
      background-color: var(--dark-gray);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 15px;
      border: 1px solid var(--medium-gray);
      transition: all 0.3s;
    }

    .payment-method:hover {
      border-color: var(--primary);
    }

    .payment-method.active {
      border: 2px solid var(--primary);
      background-color: rgba(229, 9, 20, 0.1);
    }

    .payment-icon {
      font-size: 1.8rem;
    }

    .payment-method .payment-name {
      font-weight: 500;
    }

    .payment-form {
      margin-top: 30px;
    }

    .payment-form h3 {
      margin-bottom: 15px;
      color: var(--primary);
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      background-color: var(--dark-gray);
      border: 1px solid var(--medium-gray);
      border-radius: 4px;
      color: var(--light);
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-row {
      display: flex;
      gap: 15px;
    }

    .form-row .form-group {
      flex: 1;
    }

    /* Confirmation Modal */
    .confirmation-modal {
      text-align: center;
      padding: 30px;
      max-width: 600px;
      margin: 0 auto;
    }

    .confirmation-icon {
      font-size: 4rem;
      color: var(--primary);
      margin-bottom: 20px;
      animation: bounce 0.5s;
    }

    .confirmation-message {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: var(--light);
    }

    .confirmation-details {
      background-color: var(--dark-gray);
      padding: 20px;
      border-radius: 8px;
      margin: 30px 0;
      text-align: left;
      border-left: 4px solid var(--primary);
    }

    .confirmation-details p {
      margin-bottom: 10px;
      color: var(--light-gray);
    }

    .confirmation-details .detail {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .confirmation-details .detail span {
      font-weight: 500;
    }

    .confirmation-details .detail-value {
      color: var(--light);
    }

    .confirmation-details h3 {
      margin-bottom: 15px;
      color: var(--primary);
    }

    .ticket-qr {
      width: 150px;
      height: 150px;
      margin: 20px auto;
      background-color: white;
      padding: 10px;
      border-radius: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      image-rendering: crisp-edges;
      /* This is the key property */
      -webkit-image-rendering: crisp-edges;
      /* For Safari */
    }

    .ticket-qr img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      image-rendering: crisp-edges;
      -webkit-image-rendering: crisp-edges;
    }

    /* Footer */
    footer {
      background-color: var(--dark-gray);
      padding: 50px;
      text-align: center;
      margin-top: 50px;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .footer-links a {
      color: var(--light-gray);
      text-decoration: none;
      transition: color 0.3s;
    }

    .footer-links a:hover {
      color: var(--primary);
    }

    .social-icons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    .social-icons a {
      color: var(--light);
      font-size: 1.5rem;
      transition: color 0.3s;
    }

    .social-icons a:hover {
      color: var(--primary);
    }

    .copyright {
      color: var(--light-gray);
      font-size: 0.9rem;
    }

    /* Loading State */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: var(--light-gray);
      gap: 10px;
    }

    .loading i {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    /* Add to your existing styles */
    .btn-primary[disabled] {
      opacity: 0.7;
      cursor: not-allowed;
    }


    .fa-spin {
      animation: spin 1s linear infinite;
    }


    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Auth Modal */
    .auth-modal {
      display: block;
      /* Make sure it's visible when opened */
      max-width: 500px;
      margin: 100px auto;
      background-color: var(--dark-gray);
      color: var(--light);
      border-radius: 8px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
      overflow: hidden;
      z-index: 1100;
    }

    .auth-modal .modal-header {
      background-color: var(--dark);
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid var(--medium-gray);
    }

    .auth-modal .modal-header h2 {
      margin: 0;
      font-size: 1.8rem;
      color: var(--primary);
    }

    .auth-modal .modal-body {
      padding: 20px;
    }

    .auth-modal .modal-body {
      padding: 20px;
    }

    .auth-modal .modal-header h2 {
      margin: 0;
      font-size: 1.8rem;
      color: var(--primary);
    }

    .auth-tabs {
      display: flex;
      border-bottom: 1px solid var(--medium-gray);
    }

    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 15px;
      cursor: pointer;
      font-weight: 500;
      color: var(--light-gray);
      transition: all 0.3s;
    }

    .auth-tab.active {
      color: var(--primary);
      border-bottom: 3px solid var(--primary);
    }

    .auth-content {
      padding: 30px;
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .auth-form .form-group {
      margin-bottom: 0;
    }

    .auth-form .btn {
      width: 100%;
      margin-top: 10px;
    }

    .auth-switch {
      text-align: center;
      margin-top: 20px;
      color: var(--light-gray);
    }

    .auth-switch a {
      color: var(--primary);
      text-decoration: none;
    }

    .auth-switch a:hover {
      text-decoration: underline;
    }

    .seat-selection {
      background-color: var(--dark-gray);
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      margin: 20px auto;
      max-width: 1000px;
      display: none;
      position: relative;
    }

    .seat-selection::before {
      content: 'SELECT YOUR SEATS';
      position: absolute;
      top: -15px;
      left: 20px;
      background-color: var(--primary);
      color: white;
      padding: 5px 15px;
      border-radius: 5px;
      font-weight: bold;
      font-size: 0.9rem;
    }

    /* Back button */
    .back-button {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: var(--light);
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .back-button:hover {
      color: var(--primary);
    }

    /* Responsive Styles */
    @media (max-width: 1024px) {
      .modal-body {
        flex-direction: column;
      }

      .showtime-selector {
        width: 100%;
        border-left: none;
        border-top: 1px solid var(--medium-gray);
      }

      .payment-methods {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      header {
        padding: 15px 20px;
      }

      nav ul {
        display: none;
      }

      .hero {
        padding: 0 20px;
        height: 80vh;
      }

      .hero h1 {
        font-size: 2.5rem;
      }

      .hero-buttons {
        flex-direction: column;
        gap: 15px;
      }

      .section {
        padding: 30px 20px;
      }

      .movie-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 20px;
      }

      .movie-poster {
        height: 250px;
      }

      .time-slots {
        grid-template-columns: repeat(2, 1fr);
      }

      .seat {
        width: 30px;
        height: 30px;
        margin: 0 3px;
        font-size: 0.6rem;
      }
    }

    @media (max-width: 480px) {
      .logo span {
        display: none;
      }

      .hero h1 {
        font-size: 2rem;
      }

      .filter-controls {
        flex-direction: column;
        gap: 10px;
      }

      .filter-controls select,
      .filter-controls input {
        min-width: 100%;
      }

      .modal-content {
        margin: 20px auto;
        border-radius: 0;
      }

      .checkout-steps {
        flex-direction: column;
        border-bottom: none;
      }

      .step {
        padding: 10px;
        border-bottom: 1px solid var(--medium-gray);
      }

      .step.active {
        border-bottom: 1px solid var(--primary);
      }

      .step.active::after {
        display: none;
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <a href="#" class="logo">
      <i class="fas fa-film"></i>
      <span>CineBook</span>
    </a>
    <nav>
      <ul>
        <li><a href="#now-showing">Movies</a></li>
        <li><a href="#">Cinemas</a></li>
        <li><a href="#">Offers</a></li>
        <li><a href="#">Food & Drinks</a></li>
      </ul>
    </nav>
    <div class="auth-buttons">
      <button class="btn btn-outline" onclick="showLoginModal()">Sign In</button>
      <button class="btn btn-primary" onclick="showSignupModal()">Sign Up</button>
    </div>
    <div class="user-profile" style="display: none;">
      <div class="user-avatar">JD</div>
      <div class="user-menu">
        <a href="#"><i class="fas fa-user"></i> My Profile</a>
        <a href="#"><i class="fas fa-ticket-alt"></i> My Bookings</a>
        <a href="#"><i class="fas fa-cog"></i> Settings</a>
        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <h1>Book Your Movie Tickets Online</h1>
      <p>Skip the line and reserve your seats in advance. Enjoy the latest blockbusters in comfort.</p>
      <div class="hero-buttons">
        <button class="btn btn-primary btn-lg" onclick="scrollToMovies()">
          <i class="fas fa-ticket-alt"></i> Book Now
        </button>
        <button class="btn btn-outline btn-lg" onclick="showSignupModal()">
          <i class="fas fa-user-plus"></i> Create Account
        </button>
      </div>
    </div>
  </section>

  <!-- Now Showing Section -->
  <section class="section" id="now-showing">
    <div class="section-title">
      <h2>Now Showing</h2>
      <a href="#" class="view-all">View All</a>
    </div>
    <div class="filter-controls">
      <select id="genreFilter">
        <option value="">All Genres</option>
        <option value="action">Action</option>
        <option value="comedy">Comedy</option>
        <option value="drama">Drama</option>
        <option value="horror">Horror</option>
        <option value="sci-fi">Sci-Fi</option>
      </select>
      <select id="languageFilter">
        <option value="">All Languages</option>
        <option value="english">English</option>
        <option value="hindi">Hindi</option>
        <option value="spanish">Spanish</option>
        <option value="french">French</option>
      </select>
      <input type="text" id="movieSearch" placeholder="Search movies..." oninput="searchMovies()">
    </div>
    <div class="movie-grid" id="nowShowingMovies">
      <div class="loading">
        <i class="fas fa-spinner"></i> Loading movies...
      </div>
    </div>
  </section>

  <!-- Coming Soon Section -->
  <section class="section" id="coming-soon">
    <div class="section-title">
      <h2>Coming Soon</h2>
      <a href="#" class="view-all">View All</a>
    </div>
    <div class="movie-grid" id="comingSoonMovies">
      <div class="loading">
        <i class="fas fa-spinner"></i> Loading upcoming movies...
      </div>
    </div>
  </section>

  <!-- Movie Modal -->
  <div class="modal" id="movieModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Movie Title</h2>
        <button class="close-modal" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="movie-details">
          <div class="movie-trailer">
            <!-- Embedded video will be added here -->
          </div>
          <div class="movie-description">
            <p>Movie description will be loaded here.</p>
          </div>
          <div class="movie-cast">
            <h3>Cast</h3>
            <p>Cast members will be listed here.</p>
          </div>
          <div class="movie-director">
            <h3>Director</h3>
            <p>Director's name will be shown here.</p>
          </div>
          <div class="movie-rating-info">
            <h3>Rating</h3>
            <p>
              <span class="rating-badge">4.5★</span>
              <span>PG-13 | 2h 46min | Action, Adventure, Sci-Fi</span>
            </p>
          </div>
        </div>
        <div class="showtime-selector">
          <h3>Select Showtime</h3>
          <div class="showtime-date">
            <h4>Date</h4>
            <div class="date-selector">
              <!-- Dates will be loaded here -->
            </div>
          </div>
          <div class="showtime-time">
            <h4>Time</h4>
            <div class="time-slots">
              <!-- Times will be loaded here -->
            </div>
          </div>
          <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="showSeatSelection()">
            <i class="fas fa-chair"></i> Select Seats
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Seat Selection Section -->
  <div class="seat-selection" id="seatSelection">
    <button class="back-button" onclick="backToShowtimes()">
      <i class="fas fa-arrow-left"></i> Back to Showtimes
    </button>
    <div class="screen">SCREEN THIS WAY</div>
    <div class="seat-map-container">
      <div class="seat-map" id="seatMap">
        <!-- Seats will be loaded here -->
      </div>
    </div>

    <div class="seat-legend">
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--light);"></div>
        <span>Available</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--primary);"></div>
        <span>Selected</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--secondary);"></div>
        <span>VIP</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: var(--dark-gray);"></div>
        <span>Occupied</span>
      </div>
    </div>

    <div class="booking-summary">
      <h3>Booking Summary</h3>
      <div class="summary-row">
        <span>Movie:</span>
        <span id="bookingMovieTitle">-</span>
      </div>
      <div class="summary-row">
        <span>Date & Time:</span>
        <span id="bookingDateTime">-</span>
      </div>
      <div class="summary-row">
        <span>Theater:</span>
        <span id="bookingTheater">-</span>
      </div>
      <div class="summary-row">
        <span>Seats:</span>
        <span id="selectedSeats">None selected</span>
      </div>
      <div class="summary-row">
        <span>Standard Tickets:</span>
        <span id="standardTickets">$0.00</span>
      </div>
      <div class="summary-row">
        <span>VIP Tickets:</span>
        <span id="vipTickets">$0.00</span>
      </div>
      <div class="summary-row total">
        <span>Total:</span>
        <span id="bookingTotal">$0.00</span>
      </div>

      <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="openCheckoutModal()">
        <i class="fas fa-credit-card"></i> Proceed to Checkout
      </button>
    </div>
  </div>

  <!-- Checkout Modal -->
  <div class="modal" id="checkoutModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Complete Your Booking</h2>
        <button class="close-modal" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" style="display:block; padding:0;">
        <div class="checkout-steps">
          <div class="step active">1. Payment</div>
          <div class="step">2. Confirmation</div>
        </div>

        <div class="payment-section">
          <h3 style="padding: 0 20px;">Select Payment Method</h3>
          <div class="payment-methods" style="padding: 0 20px 20px 20px;">
            <div class="payment-method active" onclick="selectPaymentMethod('card')">
              <i class="fab fa-cc-visa payment-icon"></i>
              <div class="payment-name">Credit/Debit Card</div>
            </div>
            <div class="payment-method" onclick="selectPaymentMethod('paypal')">
              <i class="fab fa-paypal payment-icon"></i>
              <div class="payment-name">PayPal</div>
            </div>
            <div class="payment-method" onclick="selectPaymentMethod('wallet')">
              <i class="fas fa-wallet payment-icon"></i>
              <div class="payment-name">Wallet</div>
            </div>
            <div class="payment-method" onclick="selectPaymentMethod('upi')">
              <i class="fas fa-qrcode payment-icon"></i>
              <div class="payment-name">UPI/QR Code</div>
            </div>
          </div>

          <div class="payment-form" id="cardPaymentForm" style="padding: 0 20px 20px 20px;">
            <h3>Card Details</h3>
            <div class="form-group">
              <label for="cardNumber">Card Number</label>
              <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456">
            </div>
            <div class="form-group">
              <label for="cardName">Name on Card</label>
              <input type="text" id="cardName" placeholder="John Doe">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="expiryDate">Expiry Date</label>
                <input type="text" id="expiryDate" placeholder="MM/YY">
              </div>
              <div class="form-group">
                <label for="cvv">CVV</label>
                <input type="text" id="cvv" placeholder="123">
              </div>
            </div>
          </div>

          <div id="otherPaymentForms" style="display: none; padding: 20px;">
            <!-- Other payment methods would be shown here -->
            <div class="loading">
              <i class="fas fa-spinner"></i> Loading payment method...
            </div>
          </div>

          <div class="booking-summary" style="margin: 20px; padding: 20px;">
            <h3>Order Summary</h3>
            <div class="summary-row">
              <span>Movie:</span>
              <span id="checkoutMovieTitle">-</span>
            </div>
            <div class="summary-row">
              <span>Date & Time:</span>
              <span id="checkoutDateTime">-</span>
            </div>
            <div class="summary-row">
              <span>Theater:</span>
              <span id="checkoutTheater">-</span>
            </div>
            <div class="summary-row">
              <span>Seats:</span>
              <span id="checkoutSeats">-</span>
            </div>
            <div class="summary-row">
              <span>Subtotal:</span>
              <span id="checkoutSubtotal">$0.00</span>
            </div>
            <div class="summary-row">
              <span>Convenience Fee:</span>
              <span>$2.00</span>
            </div>
            <div class="summary-row total">
              <span>Total:</span>
              <span id="checkoutTotal">$0.00</span>
            </div>
          </div>

          <div style="padding: 0 20px 20px 20px;">
            <button class="btn btn-primary" style="width:100%;" onclick="processPayment()">
              <i class="fas fa-lock"></i> Pay Now
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal" id="confirmationModal">
    <div class="modal-content confirmation-modal">
      <div class="confirmation-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="confirmation-message">
        Booking Confirmed!
      </div>
      <div class="confirmation-details">
        <h3>Your Booking Details</h3>
        <div class="summary-row">
          <span>Booking ID:</span>
          <span id="confirmationBookingId">-</span>
        </div>
        <div class="summary-row">
          <span>Movie:</span>
          <span id="confirmationMovieTitle">-</span>
        </div>
        <div class="summary-row">
          <span>Date & Time:</span>
          <span id="confirmationDateTime">-</span>
        </div>
        <div class="summary-row">
          <span>Theater:</span>
          <span id="confirmationTheater">-</span>
        </div>
        <div class="summary-row">
          <span>Seats:</span>
          <span id="confirmationSeats">-</span>
        </div>
        <div class="summary-row total">
          <span>Total Paid:</span>
          <span id="confirmationTotal">$0.00</span>
        </div>
      </div>
      <div class="ticket-qr">
        <!-- QR code would be displayed here -->
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=BookingID:123456" alt="QR Code">
      </div>
      <p>Your tickets have been sent to your email. Present this QR code at the theater.</p>
      <button class="btn btn-primary" style="margin-top: 20px;" onclick="closeModal()">
        <i class="fas fa-print"></i> Print Tickets
      </button>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="modal" id="authModal">
    <div class="modal-content auth-modal">
      <div class="auth-tabs">
        <div class="auth-tab active" onclick="switchAuthTab('login')">Login</div>
        <div class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</div>
      </div>
      <div class="auth-content">
        <div id="loginForm" class="auth-form">
          <div class="form-group">
            <label for="loginEmail">Email</label>
            <input type="email" id="loginEmail" placeholder="Enter your email">
          </div>
          <div class="form-group">
            <label for="loginPassword">Password</label>
            <input type="password" id="loginPassword" placeholder="Enter your password">
          </div>
          <button class="btn btn-primary" onclick="login()">
            <i class="fas fa-sign-in-alt"></i> Login
          </button>
          <div class="auth-switch">
            Don't have an account? <a href="#" onclick="switchAuthTab('signup')">Sign up</a>
          </div>
        </div>

        <div id="signupForm" class="auth-form" style="display: none;">
          <div class="form-group">
            <label for="signupName">Full Name</label>
            <input type="text" id="signupName" placeholder="Enter your full name">
          </div>
          <div class="form-group">
            <label for="signupEmail">Email</label>
            <input type="email" id="signupEmail" placeholder="Enter your email">
          </div>
          <div class="form-group">
            <label for="signupPassword">Password</label>
            <input type="password" id="signupPassword" placeholder="Create a password (min 6 chars)">
          </div>
          <div class="form-group">
            <label for="signupConfirmPassword">Confirm Password</label>
            <input type="password" id="signupConfirmPassword" placeholder="Confirm your password">
          </div>
          <button class="btn btn-primary" onclick="signUp()">
            <i class="fas fa-user-plus"></i> Sign Up
          </button>
          <div class="auth-switch">
            Already have an account? <a href="#" onclick="switchAuthTab('login')">Login</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-links">
      <a href="#">About Us</a>
      <a href="#">Contact</a>
      <a href="#">Terms of Service</a>
      <a href="#">Privacy Policy</a>
      <a href="#">FAQs</a>
    </div>
    <div class="social-icons">
      <a href="#"><i class="fab fa-facebook"></i></a>
      <a href="#"><i class="fab fa-twitter"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-youtube"></i></a>
    </div>
    <p class="copyright">© 2023 CineBook. All rights reserved.</p>
  </footer>

  <!-- Firebase and Stripe JS -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-functions-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database.js"></script>
  <script src="https://js.stripe.com/v3/"></script>

  <script>
    // Firebase configuration - REPLACE WITH YOUR CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyDI9Zinr-244vpVqnhvWCGYRibEkI8Akcw",
      authDomain: "cinebook-1a011.firebaseapp.com",
      databaseURL: "https://cinebook-1a011-default-rtdb.firebaseio.com",
      projectId: "cinebook-1a011",
      storageBucket: "cinebook-1a011.appspot.com",
      messagingSenderId: "95353759074",
      appId: "1:95353759074:web:dfd6e3d7e4b76b1538783b"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const functions = firebase.functions();

    // Initialize Stripe - REPLACE WITH YOUR KEY
    const stripe = Stripe('pk_test_your_stripe_publishable_key');

    // Firebase collections
    const moviesRef = db.collection("movies");
    const showsRef = db.collection("shows");
    const bookingsRef = db.collection("bookings");
    const usersRef = db.collection("users");

    // Global variables
    let currentUser = null;
    let selectedMovie = null;
    let selectedShow = null;
    let selectedSeats = [];
    let currentBooking = null;
    let allMovies = [];

    // DOM Content Loaded
    document.addEventListener('DOMContentLoaded', function () {
      // Load movies
      loadMovies('now_showing', 'nowShowingMovies');
      loadMovies('coming_soon', 'comingSoonMovies');

      // Setup auth state listener
      setupAuthStateListener();

      // Setup event listeners
      setupEventListeners();
    });

    // ======================
    // AUTHENTICATION SYSTEM
    // ======================
    function setupAuthStateListener() {
      auth.onAuthStateChanged(user => {
        currentUser = user;
        if (user) {
          // User is signed in
          document.querySelector('.auth-buttons').style.display = 'none';
          document.querySelector('.user-profile').style.display = 'flex';
          document.querySelector('.user-avatar').textContent =
            user.displayName ? user.displayName.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase();

          // Update user profile menu
          const userMenu = document.querySelector('.user-menu');
          userMenu.innerHTML = `
            <a href="#"><i class="fas fa-user"></i> ${user.displayName || 'My Profile'}</a>
            <a href="#" onclick="viewBookings()"><i class="fas fa-ticket-alt"></i> My Bookings</a>
            <a href="#"><i class="fas fa-cog"></i> Settings</a>
            <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
          `;
        } else {
          // No user signed in
          document.querySelector('.auth-buttons').style.display = 'flex';
          document.querySelector('.user-profile').style.display = 'none';
        }
      });
    }

    function showLoginModal() {
      document.getElementById('authModal').style.display = 'block';
      switchAuthTab('login');
    }

    function showSignupModal() {
      document.getElementById('authModal').style.display = 'block';
      switchAuthTab('signup');
    }

    function switchAuthTab(tab) {
      if (tab === 'login') {
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('signupForm').style.display = 'none';
        document.querySelector('.auth-tab').classList.add('active');
        document.querySelectorAll('.auth-tab')[1].classList.remove('active');
      } else {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('signupForm').style.display = 'block';
        document.querySelector('.auth-tab').classList.remove('active');
        document.querySelectorAll('.auth-tab')[1].classList.add('active');
      }
    }

    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      if (!email || !password) {
        showToast('Please enter both email and password', 'error');
        return;
      }

      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        closeModal();
        showToast('Login successful!');
      } catch (error) {
        let errorMessage = error.message;
        if (error.code === 'auth/user-not-found') {
          errorMessage = 'No account found with this email';
        } else if (error.code === 'auth/wrong-password') {
          errorMessage = 'Incorrect password';
        }
        showToast(errorMessage, 'error');
      }
    }

    async function signUp() {
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const confirmPassword = document.getElementById('signupConfirmPassword').value;

      if (!name || !email || !password || !confirmPassword) {
        showToast('Please fill all fields', 'error');
        return;
      }

      if (password !== confirmPassword) {
        showToast('Passwords do not match', 'error');
        return;
      }

      if (password.length < 6) {
        showToast('Password must be at least 6 characters', 'error');
        return;
      }

      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        await userCredential.user.updateProfile({ displayName: name });
        await usersRef.doc(userCredential.user.uid).set({
          name: name,
          email: email,
          bookings: [],
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        closeModal();
        showToast('Account created successfully!');
      } catch (error) {
        let errorMessage = error.message;
        if (error.code === 'auth/email-already-in-use') {
          errorMessage = 'Email already in use';
        }
        showToast(errorMessage, 'error');
      }
    }

    function logout() {
      auth.signOut();
      showToast('Logged out successfully');
    }

    function viewBookings() {
      if (!currentUser) {
        showLoginModal();
        return;
      }
      // Implement booking view functionality
      alert('Your bookings will be displayed here.');
    }

    // =================
    // MOVIE MANAGEMENT
    // =================
    async function loadMovies(status, elementId) {
      const movieGrid = document.getElementById(elementId);
      movieGrid.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i> Loading movies...</div>';

      try {
        let query = moviesRef.where('status', '==', status);

        // Apply genre filter if selected and it's for now showing movies
        if (status === 'now_showing') {
          const genreFilter = document.getElementById('genreFilter').value;
          if (genreFilter) {
            query = query.where('genres', 'array-contains', genreFilter);
          }
        }

        const snapshot = await query.get();
        allMovies = []; // Reset allMovies array

        if (snapshot.empty) {
          movieGrid.innerHTML = '<div class="no-movies">No movies found</div>';
          return;
        }

        movieGrid.innerHTML = '';

        snapshot.forEach(doc => {
          const movie = { id: doc.id, ...doc.data() };
          allMovies.push(movie); // Add to allMovies array for search functionality

          const movieElement = document.createElement('div');
          movieElement.className = 'movie-card';
          movieElement.onclick = () => openMovieModal(movie.id);

          movieElement.innerHTML = `
        <img src="${movie.posterUrl}" alt="${movie.title}" class="movie-poster">
        <div class="movie-info">
          <h3 class="movie-title">${movie.title}</h3>
          <div class="movie-meta">
            <span>${movie.genres.join(', ')}</span>
            <span class="movie-rating">${movie.rating}★</span>
          </div>
        </div>
      `;

          movieGrid.appendChild(movieElement);
        });
      } catch (error) {
        movieGrid.innerHTML = '<div class="error">Failed to load movies. Please try again.</div>';
        console.error("Error loading movies:", error);
      }
    }

    // Search movies function
    function searchMovies() {
      const searchTerm = document.getElementById('movieSearch').value.toLowerCase();
      const movieGrid = document.getElementById('nowShowingMovies');

      if (!searchTerm) {
        loadMovies('now_showing', 'nowShowingMovies');
        return;
      }

      const filteredMovies = allMovies.filter(movie =>
        movie.title.toLowerCase().includes(searchTerm) ||
        movie.genres.some(genre => genre.toLowerCase().includes(searchTerm))
          .slice(0, 10)); // Limit to 10 results

      if (filteredMovies.length === 0) {
        movieGrid.innerHTML = '<div class="no-movies">No movies found matching your search</div>';
        return;
      }

      movieGrid.innerHTML = '';
      filteredMovies.forEach(movie => {
        movieGrid.innerHTML += `
          <div class="movie-card" onclick="openMovieModal('${movie.id}')">
            <img src="${movie.posterUrl}" alt="${movie.title}" class="movie-poster">
            <div class="movie-info">
              <h3 class="movie-title">${movie.title}</h3>
              <div class="movie-meta">
                <span>${movie.genres.join(', ')}</span>
                <span class="movie-rating">${movie.rating}★</span>
              </div>
            </div>
          </div>
        `;
      });
    }

    async function openMovieModal(movieId) {
      try {
        const movieDoc = await moviesRef.doc(movieId).get();
        if (!movieDoc.exists) throw new Error("Movie not found");

        selectedMovie = { id: movieDoc.id, ...movieDoc.data() };
        const modal = document.getElementById('movieModal');

        // Update modal content with movie data
        modal.querySelector('.modal-header h2').textContent = selectedMovie.title;
        modal.querySelector('.movie-trailer').innerHTML = `
      <iframe width="100%" height="100%" src="${selectedMovie.trailerUrl}" 
      frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
      allowfullscreen></iframe>
    `;
        modal.querySelector('.movie-description p').textContent = selectedMovie.description;
        modal.querySelector('.movie-cast p').textContent = selectedMovie.cast.join(', ');
        modal.querySelector('.movie-director p').textContent = selectedMovie.director;
        modal.querySelector('.movie-rating-info p').innerHTML = `
      <span class="rating-badge">${selectedMovie.rating}★</span>
      <span>${selectedMovie.certification} | ${formatDuration(selectedMovie.duration)} | ${selectedMovie.genres.join(', ')}</span>
    `;

        // Hide showtime selector for coming soon movies
        const showtimeSelector = modal.querySelector('.showtime-selector');
        if (selectedMovie.status === 'coming_soon') {
          showtimeSelector.style.display = 'none';
        } else {
          showtimeSelector.style.display = 'block';
          loadShowtimes(movieId);
        }

        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
      } catch (error) {
        showToast("Failed to load movie details: " + error.message, 'error');
      }
    }

    // ===================
    // SHOWTIME MANAGEMENT
    // ===================
    async function loadShowtimes(movieId) {
      const dateSelector = document.querySelector('.date-selector');
      dateSelector.innerHTML = '';

      // Get showtimes for next 7 days
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);

        const dateStr = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        const dateKey = formatDateKey(date);

        dateSelector.innerHTML += `
          <div class="date-option ${i === 0 ? 'active' : ''}" data-date="${dateKey}">
            ${i === 0 ? 'Today' : dateStr}
          </div>
        `;
      }

      // Load times for first date
      const firstDate = dateSelector.querySelector('.date-option').dataset.date;
      loadTimeSlots(movieId, firstDate);

      // Add click handlers for date selection
      dateSelector.querySelectorAll('.date-option').forEach(option => {
        option.addEventListener('click', function () {
          document.querySelectorAll('.date-option').forEach(o => o.classList.remove('active'));
          this.classList.add('active');
          loadTimeSlots(movieId, this.dataset.date);
        });
      });
    }

    function formatDateKey(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    async function loadTimeSlots(movieId, date) {
      const timeSlots = document.querySelector('.time-slots');
      timeSlots.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i> Loading showtimes...</div>';

      try {
        const snapshot = await showsRef
          .where('movieId', '==', movieId)
          .where('date', '==', date)
          .orderBy('time')
          .get();

        if (snapshot.empty) {
          timeSlots.innerHTML = '<div class="no-showtimes">No showtimes available for this date</div>';
          return;
        }

        timeSlots.innerHTML = '';
        snapshot.forEach(doc => {
          const show = doc.data();
          const timeSlot = document.createElement('div');
          timeSlot.className = 'time-slot';
          timeSlot.dataset.showid = doc.id;
          timeSlot.textContent = show.time;
          timeSlot.title = `${show.theater} - ${show.location || ''}`;

          // Add click handler for time selection
          timeSlot.addEventListener('click', function () {
            document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('active'));
            this.classList.add('active');
            selectedShow = { id: doc.id, ...show }; // Store the selected show
          });

          timeSlots.appendChild(timeSlot);
        });

        // Activate first time slot if available
        const firstTimeSlot = timeSlots.querySelector('.time-slot');
        if (firstTimeSlot) {
          firstTimeSlot.classList.add('active');
          const firstShow = snapshot.docs[0].data();
          selectedShow = { id: snapshot.docs[0].id, ...firstShow };
        }
      } catch (error) {
        console.error("Error loading showtimes:", error);
        timeSlots.innerHTML = '<div class="error">Failed to load showtimes</div>';
      }
    }

    // =================
    // SEAT BOOKING
    // =================
    async function showSeatSelection() {
      if (!selectedShow) {
        showToast('Please select a showtime first', 'error');
        return;
      }

      try {
        const seatSelection = document.getElementById('seatSelection');

        // Update booking summary
        document.getElementById('bookingMovieTitle').textContent = selectedShow.movieTitle;
        document.getElementById('bookingDateTime').textContent =
          `${formatDisplayDate(selectedShow.date)}, ${selectedShow.time}`;
        document.getElementById('bookingTheater').textContent = selectedShow.theater || "Unknown Theater";

        // Generate seat map
        if (selectedShow.seatMap) {
          generateSeatMap(selectedShow.seatMap);
        } else {
          // If no seat map is defined, create a default one
          const defaultSeatMap = createDefaultSeatMap();
          generateSeatMap(defaultSeatMap);
        }

        document.getElementById('movieModal').style.display = 'none';
        seatSelection.style.display = 'block';
        seatSelection.scrollIntoView({ behavior: 'smooth' });
        document.body.style.overflow = 'auto';

        // Auto-scroll to seat selection
        setTimeout(() => {
          seatSelection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);

      } catch (error) {
        showToast("Failed to load seat selection: " + error.message, 'error');
      }
    }

    // Create a default seat map if none is provided
    function createDefaultSeatMap() {
      const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G'];
      const seatsPerRow = 10;
      const seatMap = [];

      rows.forEach((row, rowIndex) => {
        for (let i = 1; i <= seatsPerRow; i++) {
          const seatId = `${row}${i}`;
          const isVip = rowIndex >= 4; // Rows E,F,G are VIP
          const price = isVip ? 15.00 : 10.00;

          seatMap.push({
            id: seatId,
            row: row,
            number: seatId,
            type: isVip ? 'vip' : 'standard',
            price: price,
            status: Math.random() > 0.7 ? 'occupied' : 'available' // 30% chance of being occupied
          });
        }
      });

      return seatMap;
    }

    function formatDisplayDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
    }

    function generateSeatMap(seatMap) {
      const seatMapContainer = document.getElementById('seatMap');
      seatMapContainer.innerHTML = '';
      selectedSeats = [];

      // Group seats by row
      const rows = {};
      seatMap.forEach(seat => {
        if (!rows[seat.row]) rows[seat.row] = [];
        rows[seat.row].push(seat);
      });

      // Create seat rows
      for (const row in rows) {
        const seatRow = document.createElement('div');
        seatRow.className = 'seat-row';

        rows[row].forEach(seat => {
          const seatElement = document.createElement('div');
          seatElement.className = `seat ${seat.type} ${seat.status}`;
          seatElement.textContent = seat.number;
          seatElement.dataset.seatId = seat.id;
          seatElement.dataset.price = seat.price;
          seatElement.dataset.type = seat.type;

          if (seat.status === 'available') {
            seatElement.addEventListener('click', () => toggleSeatSelection(seatElement));
          } else {
            seatElement.classList.add('occupied');
          }

          seatRow.appendChild(seatElement);
        });

        seatMapContainer.appendChild(seatRow);
      }

      updateBookingSummary();
    }

    function toggleSeatSelection(seatElement) {
      seatElement.classList.toggle('selected');

      const seatId = seatElement.dataset.seatId;
      if (seatElement.classList.contains('selected')) {
        selectedSeats.push({
          id: seatId,
          number: seatElement.textContent,
          type: seatElement.dataset.type,
          price: parseFloat(seatElement.dataset.price)
        });
      } else {
        selectedSeats = selectedSeats.filter(seat => seat.id !== seatId);
      }

      updateBookingSummary();
    }

    function updateBookingSummary() {
      const standardSeats = selectedSeats.filter(seat => seat.type === 'standard');
      const vipSeats = selectedSeats.filter(seat => seat.type === 'vip');

      const standardTotal = standardSeats.reduce((sum, seat) => sum + seat.price, 0);
      const vipTotal = vipSeats.reduce((sum, seat) => sum + seat.price, 0);
      const total = standardTotal + vipTotal;

      document.getElementById('selectedSeats').textContent =
        selectedSeats.map(seat => seat.number).join(', ') || 'None selected';
      document.getElementById('standardTickets').textContent =
        `$${standardTotal.toFixed(2)} (x${standardSeats.length})`;
      document.getElementById('vipTickets').textContent =
        `$${vipTotal.toFixed(2)} (x${vipSeats.length})`;
      document.getElementById('bookingTotal').textContent = `$${total.toFixed(2)}`;
    }

    function backToShowtimes() {
      document.getElementById('seatSelection').style.display = 'none';
      document.getElementById('movieModal').style.display = 'block';
      document.getElementById('movieModal').scrollIntoView({ behavior: 'smooth' });
    }

    // =================
    // CHECKOUT PROCESS
    // =================
    function openCheckoutModal() {
      if (selectedSeats.length === 0) {
        showToast('Please select at least one seat', 'error');
        return;
      }

      if (!currentUser) {
        showLoginModal();
        showToast('Please login to continue booking', 'info');
        return;
      }

      // Update checkout summary
      document.getElementById('checkoutMovieTitle').textContent = selectedShow.movieTitle;
      document.getElementById('checkoutDateTime').textContent =
        `${formatDisplayDate(selectedShow.date)}, ${selectedShow.time}`;
      document.getElementById('checkoutTheater').textContent = selectedShow.theater;
      document.getElementById('checkoutSeats').textContent =
        selectedSeats.map(seat => seat.number).join(', ');

      const subtotal = selectedSeats.reduce((sum, seat) => sum + seat.price, 0);
      const total = subtotal + 2.00; // Add convenience fee

      document.getElementById('checkoutSubtotal').textContent = `$${subtotal.toFixed(2)}`;
      document.getElementById('checkoutTotal').textContent = `$${total.toFixed(2)}`;

      document.getElementById('seatSelection').style.display = 'none';
      document.getElementById('checkoutModal').style.display = 'block';
    }

    function selectPaymentMethod(method) {
      document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));
      event.currentTarget.classList.add('active');

      if (method === 'card') {
        document.getElementById('cardPaymentForm').style.display = 'block';
        document.getElementById('otherPaymentForms').style.display = 'none';
      } else {
        document.getElementById('cardPaymentForm').style.display = 'none';
        document.getElementById('otherPaymentForms').style.display = 'block';
        document.getElementById('otherPaymentForms').innerHTML = `
          <div class="loading">
            <i class="fas fa-spinner"></i> Preparing ${method} payment...
          </div>
        `;
        // In a real app, you would load the specific payment method UI here
      }
    }
    async function processPayment() {
      if (!validatePaymentForm()) return;

      // Show loading state
      const payButton = document.querySelector('#checkoutModal .btn-primary');
      const originalButtonText = payButton.innerHTML;
      payButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing Payment...';
      payButton.disabled = true;

      try {
        // Simulate payment processing (2 second delay)
        await new Promise(resolve => setTimeout(resolve, 2000));

        // Create booking document
        const bookingData = {
          userId: currentUser.uid,
          movieId: selectedMovie.id,
          movieTitle: selectedMovie.title,
          showId: selectedShow.id,
          theater: selectedShow.theater,
          date: selectedShow.date,
          time: selectedShow.time,
          seats: selectedSeats.map(seat => ({
            id: seat.id,
            number: seat.number,
            type: seat.type,
            price: seat.price
          })),
          subtotal: selectedSeats.reduce((sum, seat) => sum + seat.price, 0),
          convenienceFee: 2.00,
          total: selectedSeats.reduce((sum, seat) => sum + seat.price, 0) + 2.00,
          status: 'confirmed',
          paymentMethod: 'card',
          paymentStatus: 'completed',
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        // Add booking to Firestore
        const bookingRef = await bookingsRef.add(bookingData);
        console.log("Booking document written with ID: ", bookingRef.id);

        // Verify the document was created
        const docSnapshot = await bookingRef.get();
        if (!docSnapshot.exists) {
          throw new Error("Booking document was not created");
        }

        // Update user's bookings
        try {
          await usersRef.doc(currentUser.uid).update({
            bookings: firebase.firestore.FieldValue.arrayUnion(bookingRef.id),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        } catch (updateError) {
          console.error("Error updating user document: ", updateError);
        }

        currentBooking = { id: bookingRef.id, ...bookingData };
        showConfirmation();

      } catch (error) {
        console.error("Payment processing error: ", error);
        showToast("Payment failed: " + error.message, 'error');
      } finally {
        payButton.innerHTML = originalButtonText;
        payButton.disabled = false;
      }
    }

    function validatePaymentForm() {
      const cardNumber = document.getElementById('cardNumber').value;
      const cardName = document.getElementById('cardName').value;
      const expiryDate = document.getElementById('expiryDate').value;
      const cvv = document.getElementById('cvv').value;

      // Demo card details that will always pass validation
      const demoCards = [
        '4242 4242 4242 4242', // Visa
        '5555 5555 5555 4444', // Mastercard
        '3782 822463 10005',   // American Express
        '6011 1111 1111 1117'  // Discover
      ];

      // Check if it's a demo card
      const isDemoCard = demoCards.some(demo =>
        cardNumber.replace(/\s/g, '') === demo.replace(/\s/g, '')
      );

      if (!cardNumber || !cardName || !expiryDate || !cvv) {
        showToast('Please fill all payment details', 'error');
        return false;
      }

      if (!isDemoCard && !/^[4-6]\d{15}$/.test(cardNumber.replace(/\s/g, ''))) {
        showToast('Please enter a valid card number', 'error');
        return false;
      }

      if (!/^\d{2}\/\d{2}$/.test(expiryDate)) {
        showToast('Please enter a valid expiry date (MM/YY)', 'error');
        return false;
      }

      if (!/^\d{3,4}$/.test(cvv)) {
        showToast('Please enter a valid CVV', 'error');
        return false;
      }

      return true;
    }

    function showConfirmation() {
      if (!currentBooking || !currentBooking.id) {
        showToast('Booking information is missing', 'error');
        return;
      }

      document.getElementById('checkoutModal').style.display = 'none';

      // Update confirmation details
      document.getElementById('confirmationBookingId').textContent = currentBooking.id;
      document.getElementById('confirmationMovieTitle').textContent = currentBooking.movieTitle;
      document.getElementById('confirmationDateTime').textContent =
        `${formatDisplayDate(currentBooking.date)}, ${currentBooking.time}`;
      document.getElementById('confirmationTheater').textContent = currentBooking.theater;
      document.getElementById('confirmationSeats').textContent =
        currentBooking.seats.map(seat => seat.number).join(', ');
      document.getElementById('confirmationTotal').textContent = `$${currentBooking.total.toFixed(2)}`;

      // Clear previous QR code if any
      const qrContainer = document.querySelector('.ticket-qr');
      qrContainer.innerHTML = '';

      // Create new QR code image with fallback
      const qrImg = document.createElement('img');
      qrImg.onerror = function () {
        this.onerror = null;
        this.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent('BOOKING-' + currentBooking.id)}`;
      };
      qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(currentBooking.id)}`;
      qrImg.alt = 'Booking QR Code';
      qrImg.style.width = '100%';
      qrImg.style.height = 'auto';
      qrImg.style.imageRendering = 'crisp-edges';
      qrContainer.appendChild(qrImg);

      // Add demo payment note
      const demoNote = document.createElement('p');
      demoNote.style.color = 'var(--secondary)';
      demoNote.style.fontSize = '0.9rem';
      demoNote.style.marginTop = '10px';
      demoNote.textContent = 'Note: This was a demo payment. No real money was charged.';

      const detailsContainer = document.querySelector('.confirmation-details');
      if (!detailsContainer.querySelector('.demo-note')) {
        demoNote.classList.add('demo-note');
        detailsContainer.appendChild(demoNote);
      }

      document.getElementById('confirmationModal').style.display = 'block';
    }


    // ================
    // HELPER FUNCTIONS
    // ================
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.classList.add('fade-out');
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 500);
      }, 3000);
    }
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' });
    }
    function formatTime(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    }
    function formatDateTime(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
    }
    function formatDateTimeFull(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' });
    }

    function formatDuration(duration) {
      const hours = Math.floor(duration / 60);
      const minutes = duration % 60;
      return `${hours}h ${minutes}m`;
    }
    function formatCurrency(amount) {
      return `$${amount.toFixed(2)}`;
    }
    function closeCheckout() {
      document.getElementById('checkoutModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    function closeConfirmation() {
      document.getElementById('confirmationModal').style.display = 'none';
      document.body.style.overflow = 'auto';
      selectedSeats = [];
      currentBooking = null;
      loadMovies('now_showing', 'nowShowingMovies');
    }
    function showModal(modalId) {
      document.getElementById(modalId).style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    function hideModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    function switchModal(modalId) {
      document.querySelectorAll('.modal').forEach(modal => {
        modal.style.display = 'none';
      });
      document.getElementById(modalId).style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    function showMovieModal() {
      document.getElementById('movieModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    function hideMovieModal() {
      document.getElementById('movieModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    function showSeatSelectionModal() {
      document.getElementById('seatSelection').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    function hideSeatSelectionModal() {
      document.getElementById('seatSelection').style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    function showCheckoutModal() {
      document.getElementById('checkoutModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    function hideCheckoutModal() {
      document.getElementById('checkoutModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    function showConfirmationModal() {
      document.getElementById('confirmationModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    function hideConfirmationModal() {
      document.getElementById('confirmationModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    function showBookingModal() {
      document.getElementById('bookingModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    function hideBookingModal() {
      document.getElementById('bookingModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    function showUserProfile() {
      document.querySelector('.user-menu').classList.toggle('active');
    }
    function hideUserProfile() {
      document.querySelector('.user-menu').classList.remove('active');
    }
    function showMovieDetails(movieId) {
      const movie = allMovies.find(m => m.id === movieId);
      if (movie) {
        document.getElementById('movieDetailsTitle').textContent = movie.title;
        document.getElementById('movieDetailsDescription').textContent = movie.description;
        document.getElementById('movieDetailsGenres').textContent = movie.genres.join(', ');
        document.getElementById('movieDetailsRating').textContent = `${movie.rating}★`;
        document.getElementById('movieDetailsDuration').textContent = formatDuration(movie.duration);
        document.getElementById('movieDetailsModal').style.display = 'block';
      }
    }
    function hideMovieDetails() {
      document.getElementById('movieDetailsModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    function showMovieTrailer(trailerUrl) {
      const trailerModal = document.getElementById('trailerModal');
      trailerModal.querySelector('iframe').src = trailerUrl;
      trailerModal.style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    function hideMovieTrailer() {
      const trailerModal = document.getElementById('trailerModal');
      trailerModal.querySelector('iframe').src = '';
      trailerModal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    function showMovieReviews(movieId) {
      const reviewsModal = document.getElementById('reviewsModal');
      reviewsModal.style.display = 'block';
      document.body.style.overflow = 'hidden';

      // Load reviews from Firestore
      loadMovieReviews(movieId);
    }
    async function loadMovieReviews(movieId) {
      const reviewsContainer = document.getElementById('movieReviews');
      reviewsContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i> Loading reviews...</div>';

      try {
        const snapshot = await db.collection('reviews').where('movieId', '==', movieId).get();

        if (snapshot.empty) {
          reviewsContainer.innerHTML = '<div class="no-reviews">No reviews available</div>';
          return;
        }

        reviewsContainer.innerHTML = '';
        snapshot.forEach(doc => {
          const review = doc.data();
          const reviewElement = document.createElement('div');
          reviewElement.className = 'review-card';
          reviewElement.innerHTML = `
            <h4>${review.userName}</h4>
            <p>${review.comment}</p>
            <span>${review.rating}★</span>
          `;
          reviewsContainer.appendChild(reviewElement);
        });
      } catch (error) {
        console.error("Error loading reviews:", error);
        reviewsContainer.innerHTML = '<div class="error">Failed to load reviews</div>';
      }
    }
    function hideMovieReviews() {
      document.getElementById('reviewsModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    function showMovieBooking(movieId) {
      const bookingModal = document.getElementById('bookingModal');
      bookingModal.style.display = 'block';
      document.body.style.overflow = 'hidden';

      // Load booking details from Firestore
      loadMovieBooking(movieId);
    }
    async function loadMovieBooking(movieId) {
      const bookingContainer = document.getElementById('movieBooking');
      bookingContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i> Loading bookings...</div>';

      try {
        const snapshot = await db.collection('bookings').where('movieId', '==', movieId).get();

        if (snapshot.empty) {
          bookingContainer.innerHTML = '<div class="no-bookings">No bookings available</div>';
          return;
        }

        bookingContainer.innerHTML = '';
        snapshot.forEach(doc => {
          const booking = doc.data();
          const bookingElement = document.createElement('div');
          bookingElement.className = 'booking-card';
          bookingElement.innerHTML = `
            <h4>${booking.userName}</h4>
            <p>${booking.seats.join(', ')}</p>
            <span>${formatCurrency(booking.total)}</span>
          `;
          bookingContainer.appendChild(bookingElement);
        });
      } catch (error) {
        console.error("Error loading bookings:", error);
        bookingContainer.innerHTML = '<div class="error">Failed to load bookings</div>';
      }
    }
    function closeModal() {
      const modal = document.getElementById('movieModal');
      if (modal) {
        // Stop any playing trailers
        const iframe = modal.querySelector('iframe');
        if (iframe) {
          iframe.src = ''; // This stops the video
        }
        modal.style.display = 'none';
      }

      // Close other modals if needed
      document.querySelectorAll('.modal:not(#movieModal)').forEach(m => {
        m.style.display = 'none';
      });

      document.body.style.overflow = 'auto';
    }

    function scrollToMovies() {
      document.getElementById('now-showing').scrollIntoView({ behavior: 'smooth' });
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.classList.add('show');
      }, 10);

      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }

    function setupEventListeners() {
      // Close modals when clicking outside
      window.addEventListener('click', function (event) {
        if (event.target.classList.contains('modal')) {
          closeModal();
        }
      });



      // User profile dropdown
      document.querySelector('.user-profile').addEventListener('click', function (e) {
        if (e.target.closest('.user-menu')) return;
        document.querySelector('.user-menu').classList.toggle('active');
      });

      // Close user menu when clicking elsewhere
      document.addEventListener('click', function (e) {
        if (!e.target.closest('.user-profile')) {
          document.querySelector('.user-menu').classList.remove('active');
        }
      });

      // Movie search and filters
      document.getElementById('genreFilter').addEventListener('change', function () {
        loadMovies('now_showing', 'nowShowingMovies');
      });

      document.getElementById('languageFilter').addEventListener('change', function () {
        loadMovies('now_showing', 'nowShowingMovies');
      });
    }
    // Initialize Firebase
    setupAuthStateListener();
  </script>

  <style>
    /* Toast notifications */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      border-radius: 4px;
      color: white;
      font-weight: 500;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .toast.show {
      opacity: 1;
    }

    .toast-success {
      background-color: #4CAF50;
    }

    .toast-error {
      background-color: #F44336;
    }

    .toast-info {
      background-color: #2196F3;
    }
  </style>
</body>

</html>